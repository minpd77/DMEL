<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>카카오맵 + 구글 스프레드시트 CSV 연동</title>
  <style>
    #map { width: 100%; height: 600px; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_JAVASCRIPT_KEY&autoload=false"></script>
  <script>
    // 카카오 맵 초기화
    function initMap() {
      kakao.maps.load(() => {
        const mapContainer = document.getElementById('map');
        const mapOption = {
          center: new kakao.maps.LatLng(37.5665, 126.9780),
          level: 7,
        };
        const map = new kakao.maps.Map(mapContainer, mapOption);

        // CSV URL (공개된 스프레드시트 CSV)
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQpveOpTjSLo3ZOFfCaoqJlknJXl0FyhmsAy7ICy-L_EsGun7Tf9uCqZbp97_yXYQwx-p_BlTpSouwn/pub?gid=381852124&single=true&output=csv';

        fetch(csvUrl)
          .then(response => response.text())
          .then(csvText => {
            const rows = csvText.trim().split('\n').map(r => r.split(','));

            // 헤더 인덱스 찾기 (예: 위도, 경도, 현장명)
            const headers = rows[0];
            const latIdx = headers.indexOf('위도');    // AI열 한글헤더 '위도'
            const lngIdx = headers.indexOf('경도');    // AJ열 한글헤더 '경도'
            const labelIdx = headers.indexOf('현장명'); // AF열 한글헤더 '현장명'

            if (latIdx < 0 || lngIdx < 0 || labelIdx < 0) {
              alert('필요한 열(위도, 경도, 현장명)이 CSV에 없습니다.');
              return;
            }

            // 데이터 부분
            const data = rows.slice(1);

            data.forEach(row => {
              const lat = parseFloat(row[latIdx]);
              const lng = parseFloat(row[lngIdx]);
              const label = row[labelIdx];

              if (!lat || !lng) return;

              const markerPosition = new kakao.maps.LatLng(lat, lng);

              const marker = new kakao.maps.Marker({
                map: map,
                position: markerPosition,
                title: label,
              });

              const infowindow = new kakao.maps.InfoWindow({
                content: `<div style="padding:5px;">${label}</div>`,
              });

              kakao.maps.event.addListener(marker, 'mouseover', () => {
                infowindow.open(map, marker);
              });

              kakao.maps.event.addListener(marker, 'mouseout', () => {
                infowindow.close();
              });
            });
          })
          .catch(e => {
            alert('CSV 불러오기 실패: ' + e);
          });
      });
    }

    window.onload = initMap;
  </script>
</body>
</html>
